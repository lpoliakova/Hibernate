CREATE TRIGGER check_email BEFORE INSERT ON emails FOR EACH ROW BEGIN IF position('@' in NEW.email) <= 1 THEN signal sqlstate '45000' set message_text = 'Cannot add row: wrong email'; END IF; END;

CREATE TRIGGER check_private_group BEFORE INSERT ON groups_users FOR EACH ROW BEGIN IF (SELECT COUNT(*) FROM (groups_users INNER JOIN groups ON groups_users.fk_groups = groups.group_id) WHERE (groups_users.fk_groups = NEW.fk_groups && groups.group_scope = 'PRIVATE')) >= 2 THEN signal sqlstate '45000' set message_text = 'Cannot add row: private group can\'t contain more then two users'; END IF; END;